import { obras } from '../data/obras.js';
import { bindEnterGalleryButton } from '../transitions/enterGallery.js';
import { initTitleAnimations } from '../animations/hero-scroll-title.js';
import { initLoadingScreen } from '../animations/loading-screen.js';

export default function HomeView() {
  // ============================================
  // ============================================
  // Hero images for floating frames
  // ============================================
  const heroImages = obras.slice(0, 5);
  
  console.log(`üì∏ Hero: ${heroImages.length} im√°genes`);
  
  // 5 cuadros flotantes con posiciones fijas
  // ============================================
  const heroFloats = [
    { pos: 'left-frame', left: '5vw', top: '12vh', width: '180px', height: '240px', depth: '1' },
    { pos: 'top-frame', left: '48vw', top: '8vh', width: '150px', height: '180px', depth: '2' },
    { pos: 'right-frame', left: '75vw', top: '15vh', width: '280px', height: '220px', depth: '1' },
    { pos: 'bottom-left', left: '10vw', top: '70vh', width: '240px', height: '200px', depth: '3' },
    { pos: 'bottom-right', left: '72vw', top: '68vh', width: '240px', height: '280px', depth: '2' }
  ];

  const heroFloatHTML = heroFloats.map((frame, index) => {
    const obra = heroImages[index];
    const isFirstImage = index === 0;
    
    return `
      <figure class="hero-float photo-card pos-${frame.pos} pointer-events-auto" 
              data-depth="${frame.depth}"
              data-hero-id="${obra.id}"
              data-title="${obra.titulo.replace(/"/g, '&quot;')}"
              data-description="${obra.descripcion.replace(/"/g, '&quot;').replace(/'/g, '&apos;')}"
              data-year="${obra.year}"
              data-category="${obra.categoria}"
              style="position: absolute; left: ${frame.left}; top: ${frame.top}; width: ${frame.width}; height: ${frame.height}; will-change: transform;">
        <div class="photo-media relative w-full h-full cursor-pointer">
          <picture>
            <source 
              type="image/avif" 
              srcset="${obra.img}?tr=f-avif,w-400 400w, ${obra.img}?tr=f-avif,w-800 800w"
              sizes="(max-width: 768px) 200px, ${frame.width}" />
            <source 
              type="image/webp" 
              srcset="${obra.img}?tr=f-webp,w-400 400w, ${obra.img}?tr=f-webp,w-800 800w"
              sizes="(max-width: 768px) 200px, ${frame.width}" />
            <img 
              class="w-full h-full object-contain rounded-lg" 
              src="${obra.img}" 
              alt="${obra.titulo} - ${obra.categoria} photography"
              loading="${isFirstImage ? 'eager' : 'lazy'}"
              decoding="async"
              ${isFirstImage ? 'fetchpriority="high"' : ''} />
          </picture>
        </div>
      </figure>
    `;
  }).join('');
  
  // ============================================
  // GALLERY FIELD: Im√°genes con posicionamiento absoluto
  // SIN REPETIR - Solo obras 9-47
  // SIN GRAYSCALE - Solo color original
  // ============================================

  const template = `
    <div class="relative w-full min-h-screen bg-black text-white overflow-x-hidden">
      
      <!-- ========================================== -->
      <!-- NAVBAR - Minimal White Design -->
      <!-- ========================================== -->
      <nav id="navbar" class="navbar">
        <div class="container-nav">
          <!-- Logo -->
          <div class="logo">
            <span class="logo-text">Portfolio</span>
          </div>

          <!-- Desktop Navigation -->
          <div class="nav-desktop">
            <a href="#hero" class="nav-link">Home</a>
            <a href="#about" class="nav-link">About</a>
            <a href="#portfolio" class="nav-link">Portfolio</a>
            <a href="#contact" class="nav-link">Contact</a>
          </div>

          <!-- Mobile Menu Button -->
          <button id="mobile-menu-button" class="mobile-menu-btn" aria-label="Toggle menu">
            <span class="hamburger-line" id="line1"></span>
            <span class="hamburger-line" id="line2"></span>
            <span class="hamburger-line" id="line3"></span>
          </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu">
          <a href="#hero" class="mobile-nav-link">Home</a>
          <a href="#about" class="mobile-nav-link">About</a>
          <a href="#portfolio" class="mobile-nav-link">Portfolio</a>
          <a href="#contact" class="mobile-nav-link">Contact</a>
        </div>
      </nav>
      
      <!-- CINEMATIC TRANSITION CURTAIN -->
      <div id="transition-curtain"></div>

      <!-- ========================================== -->
      <!-- LOADING SCREEN - Max Milkin Style -->
      <!-- ========================================== -->
      <div id="loading-screen" class="loading-screen">
        <!-- Percentage Counter -->
        <div id="loading-percentage" class="loading-percentage">0%</div>
        
        <!-- Orbiting Text Particles Container -->
        <div id="orbit-particles" class="orbit-particles-container"></div>
      </div>

      <!-- ========================================== -->
      <!-- HERO SECTION - Claude Monet Exact Replica -->
      <!-- ========================================== -->
      <section id="hero" class="relative overflow-hidden" style="min-height: 100vh; opacity: 0;">
        <!-- Background with glow -->
        <div class="hero-bg absolute inset-0 bg-black"></div>

        <!-- Floating frames container (BEHIND title) -->
        <div id="hero-floats" class="absolute inset-0 z-5 pointer-events-none">
          ${heroFloatHTML}
        </div>

        <!-- Title + Subtitle + CTA (IN FRONT) -->
        <div class="hero-text relative z-20 flex flex-col justify-center" style="min-height: 100vh; padding-inline: max(5vw, 2rem); box-sizing: border-box;">
            <!-- Editorial Aggressive Layout -->
            <!-- MANDATORY HERO TITLE SHELL -->
            <div class="hero-title-shell">
              <h1 id="hero-title" class="hero-title">
                <span class="title-mask">
                  <span class="title-line line-1 monet-line">WORK</span>
                </span>
                <span class="title-mask">
                  <span class="title-line line-2 impressions-line">IMPRESSIONS</span>
                </span>
              </h1>
            </div>

          <!-- CTA Row: Two Buttons with Accessibility -->
          <div class="hero-cta-row flex items-center justify-center gap-6 mt-12 pointer-events-auto">
            <button 
              class="hero-cta hero-enter rounded-full border border-white/30 px-8 py-3 text-sm text-white/90 tracking-widest hover:bg-white/10 transition-all duration-300"
              aria-label="Ver galer√≠a de fotograf√≠as"
              role="button"
              tabindex="0">
              VER GALER√çA
            </button>
            <a 
              href="/contact" 
              data-link
              class="hero-cta rounded-full border border-blue-500/40 bg-blue-500/10 px-8 py-3 text-sm text-white/90 tracking-widest hover:bg-blue-500/20 transition-all duration-300"
              aria-label="Reservar sesi√≥n fotogr√°fica"
              role="button"
              tabindex="0">
              RESERVAR SESI√ìN
            </a>
          </div>
        </div>
      </section>

      <!-- ========================================== -->
      <!-- ========================================== -->
      <!-- SECTIONS - Colin Moy Style -->
      <!-- ========================================== -->
      <main class="sections-container bg-white">
        
        <!-- ABOUT SECTION -->
        <section id="about" class="section-block relative min-h-screen flex items-center justify-center bg-neutral-50 cursor-pointer hover:bg-neutral-100 transition-colors duration-300">
          <div class="text-center px-8">
            <h2 class="section-title text-8xl md:text-9xl font-bold uppercase tracking-tighter text-black">
              ABOUT
            </h2>
          </div>
        </section>

        <!-- PORTFOLIO SECTION -->
        <section id="portfolio" class="section-block relative min-h-screen flex items-center justify-center bg-white cursor-pointer hover:bg-neutral-50 transition-colors duration-300">
          <div class="text-center px-8">
            <h2 class="section-title text-8xl md:text-9xl font-bold uppercase tracking-tighter text-black">
              PORTF&#9679;LIO
            </h2>
          </div>
        </section>

        <!-- CONTACT SECTION -->
        <section id="contact" class="section-block relative min-h-screen flex items-center justify-center bg-neutral-50 cursor-pointer hover:bg-neutral-100 transition-colors duration-300">
          <div class="text-center px-8">
            <h2 class="section-title text-8xl md:text-9xl font-bold uppercase tracking-tighter text-black">
              C&#9679;NTACT
            </h2>
            <div class="mt-12">
              <button class="px-12 py-4 bg-black text-white rounded-full text-sm uppercase tracking-widest hover:bg-gray-800 transition-colors duration-300">
                ¬øC√ìMO PUEDO AYUDAR?
              </button>
            </div>
          </div>
        </section>

      </main>


    </div>
  `;
  
  // ============================================
  // Bind buttons e images despu√©s del render
  // ============================================
  setTimeout(() => {
    const app = document.querySelector('#app');
    if (app) {
      // Initialize loading screen FIRST (Max Milkin style)
      initLoadingScreen();
      
      // About button is now in global navbar, not here
      bindEnterGalleryButton(app);
      initTitleAnimations(); // Init MANDATORY advanced title animations
    }
  }, 100);
  
  return template;
}
